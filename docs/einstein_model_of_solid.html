<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>asymptotic to MARS - Einstein model for a solid</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">asymptotic to MARS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Bried Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./favourites.html" rel="" target="">
 <span class="menu-text">Favourites</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#the-system" id="toc-the-system" class="nav-link" data-scroll-target="#the-system">The system</a>
  <ul class="collapse">
  <li><a href="#classical-model" id="toc-classical-model" class="nav-link" data-scroll-target="#classical-model">Classical Model</a></li>
  </ul></li>
  <li><a href="#quantum-model-of-1-oscillator" id="toc-quantum-model-of-1-oscillator" class="nav-link" data-scroll-target="#quantum-model-of-1-oscillator">Quantum model of <span class="math inline">\(1\)</span> oscillator</a></li>
  <li><a href="#system-with-n-oscillators" id="toc-system-with-n-oscillators" class="nav-link" data-scroll-target="#system-with-n-oscillators">System with <span class="math inline">\(N\)</span> oscillators</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Einstein model for a solid</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
</section>
<section id="the-system" class="level1">
<h1>The system</h1>
<p>Our system is composed by a lattice of atoms and we want to focus our description on the oscillations performed by the nuclei, we ignore any contribution from the electrons.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/Captura de ecrã 2024-01-13 120905.png" class="img-fluid figure-img" width="264"></p>
<figcaption class="figure-caption">An exact pictorial representation of the Classic model, springs governed by Hook’s Law describe well the small oscillations.</figcaption>
</figure>
</div>
<p>We further assume each nucleus is independent and each exhibit small oscillation around it equilibrium position.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/indeposc.png" class="img-fluid figure-img" width="310"></p>
<figcaption class="figure-caption">Independent oscillators are not connected among each other. The picture shows exagerated alplitudes. Use this picticture to imagine what is like in 3D.</figcaption>
</figure>
</div>
<section id="classical-model" class="level2">
<h2 class="anchored" data-anchor-id="classical-model">Classical Model</h2>
<p><em>What is the total energy of small oscillations?</em></p>
<p>The system is a box attached to a spring, the coordinate <span class="math inline">\(x\)</span> measures the deviation from the equilibrium position and the coordinate <span class="math inline">\(p\)</span> is the box’s linear momentum. These coordinates are real functions of time.</p>
<div id="fig-1dosc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/1dosc.png" class="img-fluid figure-img" width="423"></p>
<figcaption class="figure-caption">Figure&nbsp;1: One dimensional oscilator box always wants to return to the equilibrium position. For small amplitudes <span class="math inline">\(A\)</span>, the spring force on the box is given by Hook’s law.</figcaption>
</figure>
</div>
<p><strong>The total energy of the system:</strong> We want to obtain a formula for the total energy in terms of the system coordinates using classical theory since its most familiar to us.</p>
<p>Recall it is the sum of the kinetic energy of the box, which has the usual form <span class="math inline">\(p^2/2m\)</span>, and the potential energy <span class="math inline">\(v(x)\)</span> that characterizes the spring force. What function <span class="math inline">\(v(x)\)</span> can possibly describe well such a system?</p>
<p>Note the assumptions! We want to describe small oscillations, i.e., the deviation <span class="math inline">\(x\)</span> from equilibrium must be really small, much smaller than 1, mathematically <span class="math inline">\(|x|\ll 1\)</span> or if you prefer, the limit as <span class="math inline">\(x \longrightarrow 0\)</span>.</p>
<p>With this information in our hands we can do something wonderful; we can break <span class="math inline">\(v(x)\)</span> in two parts: the relevant part and negligible one. Using the power of Taylor series we find:</p>
<p><span id="eq-taylorv"><span class="math display">\[ v(x) = \overbrace{v(0) + v'(0)x + \frac{1}{2}v''(0)x^2}^{Relevant}+\mathcal{O}(x^3).  \tag{1}\]</span></span></p>
<p><strong>To simplify</strong> <span class="math inline">\(v(x)\)</span><strong>:</strong> the constant term <span class="math inline">\(v(0)\)</span> is set to zero to simplify notation and since <span class="math inline">\(v(x)\)</span> has a minimum at <span class="math inline">\(x=0\)</span>, <span class="math inline">\(v'(0)=0\)</span> aswell. Additionally, we identify <span class="math inline">\(v''(0)\)</span> as Hook constant <span class="math inline">\(k\)</span> which, by the way, can be rewritten as <span class="math inline">\(m\omega^2\)</span>, the <span class="math inline">\(\omega\)</span> is the characteristic frequency <span class="math inline">\(\omega\)</span> of an oscillator for which this approximation is valid.</p>
<p>This makes this formula pleasantly simple</p>
<p><span id="eq-vsmallosc"><span class="math display">\[
v(x) \sim \frac{1}{2}kx^2 =\frac{1}{2}m \omega^2x^2
\tag{2}\]</span></span></p>
<p><strong>Pictorially</strong>, the rhs describes the parabola (pink) that better fits the original potential energy (blue).</p>
<div id="fig-vapprox" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/vapprox.png" class="img-fluid figure-img" width="377"></p>
<figcaption class="figure-caption">Figure&nbsp;2: The actual potential vs its approximation, valid when x is small.</figcaption>
</figure>
</div>
<p><strong>What have we achieved so far?</strong> We got the formula <a href="#eq-vsmallosc">Equation&nbsp;2</a> . Look at it as the functional form of any function that describes the potential energy as a function of <span class="math inline">\(x\)</span> of an oscillator, oscillating :) with small amplitude. Small compared to what, small enough that the third order <span class="math inline">\(\mathcal{O}(x^3)\)</span> terms of the Taylor <a href="#eq-taylorv">Equation&nbsp;1</a> are negligible compared with <span class="math inline">\(\mathcal{O}(x^2)\)</span> term.</p>
<p>The total energy of the system is now one step away, its called the Hamiltonian <span class="math inline">\(h\)</span> of the system as is (as usual) the sum of the kinetic energy plus potential energy which we express has:</p>
<p><span id="eq-oneoschamiltonian"><span class="math display">\[
h=\frac{p^2}{2m}+\frac{1}{2}m \omega^2x^2.
\tag{3}\]</span></span></p>
<p>With the classical mindset we could, if we wish, derive the laws of motion for this spring-box system using this Hamiltonian, these laws are:</p>
<p><span class="math display">\[
\begin{cases}
\dot{x} = \frac{\partial h}{\partial p}\\
\dot{p} = - \frac{\partial h}{\partial x}
\end{cases}
\]</span></p>
<p>This system of differential equations yields the functions <span class="math inline">\(x(t)\)</span> and <span class="math inline">\(p(t)\)</span>. But to compute them is not our goal.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Comment
</div>
</div>
<div class="callout-body-container callout-body">
<p>Is it me, or did I pull the frequency <span class="math inline">\(\omega\)</span> out of my a#$. Right? Here is some insight, imagine a stiff spring, then we expect a high frequency of oscillation, this is what the formula</p>
<p><span class="math display">\[ \omega =\sqrt{\frac{k}{m}},  \]</span></p>
<p>tells us, the higher the <span class="math inline">\(k\)</span> for a fixed mass <span class="math inline">\(m\)</span>, the higher the frequency <span class="math inline">\(\omega\)</span>. The formula is derived from classical theory, if you don’t remember how, don’t worry since we will not need it anyway, just take it as a fact of life that makes intuitive sense.</p>
</div>
</div>
</section>
</section>
<section id="quantum-model-of-1-oscillator" class="level1">
<h1>Quantum model of <span class="math inline">\(1\)</span> oscillator</h1>
<p><strong>What we want:</strong> It was simple to derive the classical hamiltonian <a href="#eq-oneoschamiltonian">Equation&nbsp;3</a> using classical mechanics, now we convert it into a quantum hamiltonian by translating the coordinates <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span>, real functions of time, into quantum operators of position <span class="math inline">\(\hat{x}\)</span> and <span class="math inline">\(\hat{p}\)</span>:</p>
<p><span class="math display">\[
\hat{h}=\frac{\hat{p}^2}{2m}+\frac{1}{2}m \omega^2\hat{x}^2.
\]</span></p>
<p><strong>Classical vs Quantum:</strong> In classical mechanics the system is described by the position and momentum, <span class="math inline">\((x,p)\)</span> which live in <span class="math inline">\(\mathbb{R}^2\)</span>. In quantum mechanics the system is described by the state vector <span class="math inline">\(|\psi\rangle\)</span> which live in the Hilbert space <span class="math inline">\(\mathbb{H}\)</span>.</p>
<p><strong>Goal:</strong> introduce a basis into Hilbert space <span class="math inline">\(\mathbb{H}\)</span> composed by the eigenvectors of the hamiltonian <span class="math inline">\(\hat{h}\)</span>. It is the suitable basis to describe a quantum harmonic oscillator.</p>
<p><strong>Basis:</strong> To drive this eigenstates is a rather long process which involves the introduction of creation and anihilation operators and to study their properties, we will skip the detail, the key takeaway is the structure (how the are organized) of these eigenvectors:</p>
<p><span class="math display">\[
\hat{h}|n\rangle = e_n|n\rangle,\qquad e_n = \hbar \omega(n+\frac{1}{2})
\]</span></p>
<p>The vectors <span class="math inline">\(|n\rangle\)</span> are index with integers <span class="math inline">\(n=0,1,2,..\)</span> and the corresponding eigenvectors are <span class="math inline">\(e_n\)</span>. The basis <span class="math inline">\(\{|n\rangle\}_{n=0,1,..}\)</span> is orthonormal:</p>
<p><span class="math display">\[
\langle n | n'\rangle = \delta_{n,n'}
\]</span></p>
<p><strong>General state:</strong> any state of the quantum oscillator in the hilbert space can be written as a linear combination of this basis vectors</p>
<p><span class="math display">\[
|\psi\rangle = \sum_{n=0}^\infty c_n |n\rangle
\]</span> However, in what follows we can restrict ourselves to dealing with just the basis <span class="math inline">\(|n\rangle\)</span>.</p>
</section>
<section id="system-with-n-oscillators" class="level1">
<h1>System with <span class="math inline">\(N\)</span> oscillators</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>